<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—Ö–æ–¥ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è | –í–∏–Ω–Ω—ã–π –º–∞–≥–∞–∑–∏–Ω</title>
    <link rel="stylesheet" href="../css/import.css">
</head>
<body class="body_log">
    <div class="auth-container">
        <!-- –§–æ—Ä–º–∞ –≤—Ö–æ–¥–∞ -->
        <div class="form-container login-form active">
            <div class="form-header">
                <h1 class="bergamasco-regular">–í–•–û–î</h1>
                <a href="#" class="switch-link bergamasco-regular" data-target="register">—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</a>
            </div>
            <form id="loginForm" action="log.php" method="POST">
                <input type="hidden" name="action" value="login">
                <div class="input-group">
                    <input type="text" id="loginUsername" name="username" required class="bergamasco-regular">
                    <label for="loginUsername" class="bergamasco-regular">–ò–º—è</label>
                </div>
                <div class="input-group">
                    <input type="password" id="loginPassword" name="password" required class="bergamasco-regular">
                    <label for="loginPassword" class="bergamasco-regular">–ü–∞—Ä–æ–ª—å</label>
                    <span class="toggle-password" data-target="loginPassword">üëÅÔ∏è</span>
                </div>
                <button type="submit" class="submit-btn bergamasco-regular">–í–û–ô–¢–ò</button>
                <a href="#" class="forgot-password bergamasco-regular">–∑–∞–±—ã–ª–∏ –ø–∞—Ä–æ–ª—å?</a>
            </form>
        </div>

        <!-- –§–æ—Ä–º–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏ -->
        <div class="form-container register-form">
            <div class="form-header">
                <h1 class="bergamasco-regular">–†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</h1>
                <a href="#" class="switch-link bergamasco-regular" data-target="login">–≤—Ö–æ–¥</a>
            </div>
            <form id="registerForm" action="log.php" method="POST">
                <input type="hidden" name="action" value="register">
                <div class="input-group">
                    <input type="text" id="registerUsername" name="username" required class="bergamasco-regular">
                    <label for="registerUsername" class="bergamasco-regular">–ò–º—è</label>
                </div>
                <div class="input-group">
                    <input type="email" id="registerEmail" name="email" required class="bergamasco-regular">
                    <label for="registerEmail" class="bergamasco-regular">Email</label>
                </div>
                <div class="input-group">
                    <input type="password" id="registerPassword" name="password" required class="bergamasco-regular">
                    <label for="registerPassword" class="bergamasco-regular">–ü–∞—Ä–æ–ª—å</label>
                    <span class="toggle-password" data-target="registerPassword">üëÅÔ∏è</span>
                </div>
                <div class="input-group">
                    <input type="password" id="confirmPassword" name="confirm_password" required class="bergamasco-regular">
                    <label for="confirmPassword" class="bergamasco-regular">–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                    <span class="toggle-password" data-target="confirmPassword">üëÅÔ∏è</span>
                </div>
                <button type="submit" class="submit-btn bergamasco-regular">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
            </form>
        </div>
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    checkAuthentication();

    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–æ—Ä–º–∞–º–∏
    const switchLinks = document.querySelectorAll('.switch-link');
    const loginForm = document.querySelector('.login-form');
    const registerForm = document.querySelector('.register-form');
    
    switchLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const target = this.getAttribute('data-target');
            
            if (target === 'login') {
                loginForm.classList.add('active');
                registerForm.classList.remove('active');
            } else if (target === 'register') {
                registerForm.classList.remove('active');
                loginForm.classList.remove('active');
                registerForm.classList.add('active');
            }
        });
    });
    
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∏–¥–∏–º–æ—Å—Ç–∏ –ø–∞—Ä–æ–ª—è
    const togglePasswordButtons = document.querySelectorAll('.toggle-password');
    
    togglePasswordButtons.forEach(button => {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const passwordInput = document.getElementById(targetId);
            
            if (passwordInput.type === 'password') {
                passwordInput.type = 'text';
                this.textContent = 'üôà';
            } else {
                passwordInput.type = 'password';
                this.textContent = 'üëÅÔ∏è';
            }
        });
    });
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã –≤—Ö–æ–¥–∞
    const loginFormElement = document.getElementById('loginForm');
    if (loginFormElement) {
        loginFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            submitForm('../PHP/log.php', data, 'login');
        });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º—ã —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
    const registerFormElement = document.getElementById('registerForm');
    if (registerFormElement) {
        registerFormElement.addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const data = Object.fromEntries(formData);
            
            submitForm('../PHP/log.php', data, 'register');
        });
    }
});

// –§—É–Ω–∫—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
function checkAuthentication() {
    fetch('../PHP/auth.php?check=1')
        .then(response => response.json())
        .then(data => {
            if (data.authenticated) {
                // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω, –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª—è–µ–º
                const redirectUrl = data.role === 'admin' ? '../HTML/admin.html' : '../HTML/user.html';
                window.location.href = redirectUrl;
            }
        })
        .catch(error => {
            console.error('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:', error);
        });
}

// –§—É–Ω–∫—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
function submitForm(url, data, action) {
    data.action = action;
    
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(data)
    })
    .then(response => response.json())
    .then(result => {
        if (result.success) {
            alert(result.message);
            if (result.redirect) {
                window.location.href = result.redirect;
            }
        } else {
            alert(result.message);
        }
    })
    .catch(error => {
        console.error('–û—à–∏–±–∫–∞:', error);
        alert('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Ñ–æ—Ä–º—ã');
    });
}
    </script>
</body>
</html>